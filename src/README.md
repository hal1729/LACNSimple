


<!DOCTYPE html>
<html>
  <head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# githubog: http://ogp.me/ns/fb/githubog#">
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>httpebble-watch/README.md at master · Katharine/httpebble-watch · GitHub</title>
    <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="GitHub" />
    <link rel="fluid-icon" href="https://github.com/fluidicon.png" title="GitHub" />
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-114.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-144.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144.png" />
    <link rel="logo" type="image/svg" href="https://github-media-downloads.s3.amazonaws.com/github-logo.svg" />
    <meta property="og:image" content="https://github.global.ssl.fastly.net/images/modules/logos_page/Octocat.png">
    <meta name="hostname" content="github-fe114-cp1-prd.iad.github.net">
    <meta name="ruby" content="ruby 1.9.3p194-tcs-github-tcmalloc (2012-05-25, TCS patched 2012-05-27, GitHub v1.0.36) [x86_64-linux]">
    <link rel="assets" href="https://github.global.ssl.fastly.net/">
    <link rel="conduit-xhr" href="https://ghconduit.com:25035/">
    <link rel="xhr-socket" href="/_sockets" />
    


    <meta name="msapplication-TileImage" content="/windows-tile.png" />
    <meta name="msapplication-TileColor" content="#ffffff" />
    <meta name="selected-link" value="repo_source" data-pjax-transient />
    <meta content="collector.githubapp.com" name="octolytics-host" /><meta content="github" name="octolytics-app-id" /><meta content="D8836A54:2439:12E0F7E:5247042C" name="octolytics-dimension-request_id" />
    

    
    
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />

    <meta content="authenticity_token" name="csrf-param" />
<meta content="CgD6KEmMuZlYbeME+CqG7H8s8rJv+lBAMoqgxmcTA3c=" name="csrf-token" />

    <link href="https://github.global.ssl.fastly.net/assets/github-4288f026700410ae032b5d324dea2b4571789d7c.css" media="all" rel="stylesheet" type="text/css" />
    <link href="https://github.global.ssl.fastly.net/assets/github2-88d5087029dbe346f413843c4cb0149921840ef5.css" media="all" rel="stylesheet" type="text/css" />
    

    

      <script src="https://github.global.ssl.fastly.net/assets/frameworks-4e5aeedcc7a86dcff8294cb84644a333b46202a2.js" type="text/javascript"></script>
      <script src="https://github.global.ssl.fastly.net/assets/github-3eca66e8d84a2ff6e7aa623a998827892eceb472.js" type="text/javascript"></script>
      
      <meta http-equiv="x-pjax-version" content="405a8aa4027641752499b79ebf1cb5a3">

        <link data-pjax-transient rel='permalink' href='/Katharine/httpebble-watch/blob/b98e06451f1774c785a7a750b4da27b319c1c7a3/README.md'>
  <meta property="og:title" content="httpebble-watch"/>
  <meta property="og:type" content="githubog:gitrepository"/>
  <meta property="og:url" content="https://github.com/Katharine/httpebble-watch"/>
  <meta property="og:image" content="https://github.global.ssl.fastly.net/images/gravatars/gravatar-user-420.png"/>
  <meta property="og:site_name" content="GitHub"/>
  <meta property="og:description" content="httpebble-watch - Watch side interface for httpebble"/>

  <meta name="description" content="httpebble-watch - Watch side interface for httpebble" />

  <meta content="110792" name="octolytics-dimension-user_id" /><meta content="Katharine" name="octolytics-dimension-user_login" /><meta content="10104357" name="octolytics-dimension-repository_id" /><meta content="Katharine/httpebble-watch" name="octolytics-dimension-repository_nwo" /><meta content="true" name="octolytics-dimension-repository_public" /><meta content="false" name="octolytics-dimension-repository_is_fork" /><meta content="10104357" name="octolytics-dimension-repository_network_root_id" /><meta content="Katharine/httpebble-watch" name="octolytics-dimension-repository_network_root_nwo" />
  <link href="https://github.com/Katharine/httpebble-watch/commits/master.atom" rel="alternate" title="Recent Commits to httpebble-watch:master" type="application/atom+xml" />

  </head>


  <body class="logged_out  env-production windows vis-public  page-blob">
    <div class="wrapper">
      
      
      


      
      <div class="header header-logged-out">
  <div class="container clearfix">

    <a class="header-logo-wordmark" href="https://github.com/">
      <span class="mega-octicon octicon-logo-github"></span>
    </a>

    <div class="header-actions">
        <a class="button primary" href="/signup">Sign up</a>
      <a class="button signin" href="/login?return_to=%2FKatharine%2Fhttpebble-watch%2Fblob%2Fmaster%2FREADME.md">Sign in</a>
    </div>

    <div class="command-bar js-command-bar  in-repository">

      <ul class="top-nav">
          <li class="explore"><a href="/explore">Explore</a></li>
        <li class="features"><a href="/features">Features</a></li>
          <li class="enterprise"><a href="https://enterprise.github.com/">Enterprise</a></li>
          <li class="blog"><a href="/blog">Blog</a></li>
      </ul>
        <form accept-charset="UTF-8" action="/search" class="command-bar-form" id="top_search_form" method="get">

<input type="text" data-hotkey="/ s" name="q" id="js-command-bar-field" placeholder="Search or type a command" tabindex="1" autocapitalize="off"
    
    
      data-repo="Katharine/httpebble-watch"
      data-branch="master"
      data-sha="4f50cc8899dd2b949a32a2fc689fdc03eaf905a5"
  >

    <input type="hidden" name="nwo" value="Katharine/httpebble-watch" />

    <div class="select-menu js-menu-container js-select-menu search-context-select-menu">
      <span class="minibutton select-menu-button js-menu-target">
        <span class="js-select-button">This repository</span>
      </span>

      <div class="select-menu-modal-holder js-menu-content js-navigation-container">
        <div class="select-menu-modal">

          <div class="select-menu-item js-navigation-item js-this-repository-navigation-item selected">
            <span class="select-menu-item-icon octicon octicon-check"></span>
            <input type="radio" class="js-search-this-repository" name="search_target" value="repository" checked="checked" />
            <div class="select-menu-item-text js-select-button-text">This repository</div>
          </div> <!-- /.select-menu-item -->

          <div class="select-menu-item js-navigation-item js-all-repositories-navigation-item">
            <span class="select-menu-item-icon octicon octicon-check"></span>
            <input type="radio" name="search_target" value="global" />
            <div class="select-menu-item-text js-select-button-text">All repositories</div>
          </div> <!-- /.select-menu-item -->

        </div>
      </div>
    </div>

  <span class="octicon help tooltipped downwards" title="Show command bar help">
    <span class="octicon octicon-question"></span>
  </span>


  <input type="hidden" name="ref" value="cmdform">

</form>
    </div>

  </div>
</div>


      


          <div class="site" itemscope itemtype="http://schema.org/WebPage">
    
    <div class="pagehead repohead instapaper_ignore readability-menu">
      <div class="container">
        

<ul class="pagehead-actions">


  <li>
  <a href="/login?return_to=%2FKatharine%2Fhttpebble-watch"
  class="minibutton with-count js-toggler-target star-button entice tooltipped upwards"
  title="You must be signed in to use this feature" rel="nofollow">
  <span class="octicon octicon-star"></span>Star
</a>
<a class="social-count js-social-count" href="/Katharine/httpebble-watch/stargazers">
  47
</a>

  </li>

    <li>
      <a href="/login?return_to=%2FKatharine%2Fhttpebble-watch"
        class="minibutton with-count js-toggler-target fork-button entice tooltipped upwards"
        title="You must be signed in to fork a repository" rel="nofollow">
        <span class="octicon octicon-git-branch"></span>Fork
      </a>
      <a href="/Katharine/httpebble-watch/network" class="social-count">
        13
      </a>
    </li>
</ul>

        <h1 itemscope itemtype="http://data-vocabulary.org/Breadcrumb" class="entry-title public">
          <span class="repo-label"><span>public</span></span>
          <span class="mega-octicon octicon-repo"></span>
          <span class="author">
            <a href="/Katharine" class="url fn" itemprop="url" rel="author"><span itemprop="title">Katharine</span></a></span
          ><span class="repohead-name-divider">/</span><strong
          ><a href="/Katharine/httpebble-watch" class="js-current-repository js-repo-home-link">httpebble-watch</a></strong>

          <span class="page-context-loader">
            <img alt="Octocat-spinner-32" height="16" src="https://github.global.ssl.fastly.net/images/spinners/octocat-spinner-32.gif" width="16" />
          </span>

        </h1>
      </div><!-- /.container -->
    </div><!-- /.repohead -->

    <div class="container">

      <div class="repository-with-sidebar repo-container ">

        <div class="repository-sidebar">
            

<div class="repo-nav repo-nav-full js-repository-container-pjax js-octicon-loaders">
  <div class="repo-nav-contents">
    <ul class="repo-menu">
      <li class="tooltipped leftwards" title="Code">
        <a href="/Katharine/httpebble-watch" aria-label="Code" class="js-selected-navigation-item selected" data-gotokey="c" data-pjax="true" data-selected-links="repo_source repo_downloads repo_commits repo_tags repo_branches /Katharine/httpebble-watch">
          <span class="octicon octicon-code"></span> <span class="full-word">Code</span>
          <img alt="Octocat-spinner-32" class="mini-loader" height="16" src="https://github.global.ssl.fastly.net/images/spinners/octocat-spinner-32.gif" width="16" />
</a>      </li>

        <li class="tooltipped leftwards" title="Issues">
          <a href="/Katharine/httpebble-watch/issues" aria-label="Issues" class="js-selected-navigation-item js-disable-pjax" data-gotokey="i" data-selected-links="repo_issues /Katharine/httpebble-watch/issues">
            <span class="octicon octicon-issue-opened"></span> <span class="full-word">Issues</span>
            <span class='counter'>3</span>
            <img alt="Octocat-spinner-32" class="mini-loader" height="16" src="https://github.global.ssl.fastly.net/images/spinners/octocat-spinner-32.gif" width="16" />
</a>        </li>

      <li class="tooltipped leftwards" title="Pull Requests"><a href="/Katharine/httpebble-watch/pulls" aria-label="Pull Requests" class="js-selected-navigation-item js-disable-pjax" data-gotokey="p" data-selected-links="repo_pulls /Katharine/httpebble-watch/pulls">
            <span class="octicon octicon-git-pull-request"></span> <span class="full-word">Pull Requests</span>
            <span class='counter'>1</span>
            <img alt="Octocat-spinner-32" class="mini-loader" height="16" src="https://github.global.ssl.fastly.net/images/spinners/octocat-spinner-32.gif" width="16" />
</a>      </li>


    </ul>
    <div class="repo-menu-separator"></div>
    <ul class="repo-menu">

      <li class="tooltipped leftwards" title="Pulse">
        <a href="/Katharine/httpebble-watch/pulse" aria-label="Pulse" class="js-selected-navigation-item " data-pjax="true" data-selected-links="pulse /Katharine/httpebble-watch/pulse">
          <span class="octicon octicon-pulse"></span> <span class="full-word">Pulse</span>
          <img alt="Octocat-spinner-32" class="mini-loader" height="16" src="https://github.global.ssl.fastly.net/images/spinners/octocat-spinner-32.gif" width="16" />
</a>      </li>

      <li class="tooltipped leftwards" title="Graphs">
        <a href="/Katharine/httpebble-watch/graphs" aria-label="Graphs" class="js-selected-navigation-item " data-pjax="true" data-selected-links="repo_graphs repo_contributors /Katharine/httpebble-watch/graphs">
          <span class="octicon octicon-graph"></span> <span class="full-word">Graphs</span>
          <img alt="Octocat-spinner-32" class="mini-loader" height="16" src="https://github.global.ssl.fastly.net/images/spinners/octocat-spinner-32.gif" width="16" />
</a>      </li>

      <li class="tooltipped leftwards" title="Network">
        <a href="/Katharine/httpebble-watch/network" aria-label="Network" class="js-selected-navigation-item js-disable-pjax" data-selected-links="repo_network /Katharine/httpebble-watch/network">
          <span class="octicon octicon-git-branch"></span> <span class="full-word">Network</span>
          <img alt="Octocat-spinner-32" class="mini-loader" height="16" src="https://github.global.ssl.fastly.net/images/spinners/octocat-spinner-32.gif" width="16" />
</a>      </li>
    </ul>


  </div>
</div>

            <div class="only-with-full-nav">
              

  

<div class="clone-url open"
  data-protocol-type="http"
  data-url="/users/set_protocol?protocol_selector=http&amp;protocol_type=clone">
  <h3><strong>HTTPS</strong> clone URL</h3>
  <div class="clone-url-box">
    <input type="text" class="clone js-url-field"
           value="https://github.com/Katharine/httpebble-watch.git" readonly="readonly">

    <span class="js-zeroclipboard url-box-clippy minibutton zeroclipboard-button" data-clipboard-text="https://github.com/Katharine/httpebble-watch.git" data-copied-hint="copied!" title="copy to clipboard"><span class="octicon octicon-clippy"></span></span>
  </div>
</div>

  

<div class="clone-url "
  data-protocol-type="subversion"
  data-url="/users/set_protocol?protocol_selector=subversion&amp;protocol_type=clone">
  <h3><strong>Subversion</strong> checkout URL</h3>
  <div class="clone-url-box">
    <input type="text" class="clone js-url-field"
           value="https://github.com/Katharine/httpebble-watch" readonly="readonly">

    <span class="js-zeroclipboard url-box-clippy minibutton zeroclipboard-button" data-clipboard-text="https://github.com/Katharine/httpebble-watch" data-copied-hint="copied!" title="copy to clipboard"><span class="octicon octicon-clippy"></span></span>
  </div>
</div>


<p class="clone-options">You can clone with
      <a href="#" class="js-clone-selector" data-protocol="http">HTTPS</a>,
      or <a href="#" class="js-clone-selector" data-protocol="subversion">Subversion</a>.
  <span class="octicon help tooltipped upwards" title="Get help on which URL is right for you.">
    <a href="https://help.github.com/articles/which-remote-url-should-i-use">
    <span class="octicon octicon-question"></span>
    </a>
  </span>
</p>


  <a href="http://windows.github.com" class="minibutton sidebar-button">
    <span class="octicon octicon-device-desktop"></span>
    Clone in Desktop
  </a>

              <a href="/Katharine/httpebble-watch/archive/master.zip"
                 class="minibutton sidebar-button"
                 title="Download this repository as a zip file"
                 rel="nofollow">
                <span class="octicon octicon-cloud-download"></span>
                Download ZIP
              </a>
            </div>
        </div><!-- /.repository-sidebar -->

        <div id="js-repo-pjax-container" class="repository-content context-loader-container" data-pjax-container>
          


<!-- blob contrib key: blob_contributors:v21:9dc2aec14ee278e3d1b25b595375594d -->

<p title="This is a placeholder element" class="js-history-link-replace hidden"></p>

<a href="/Katharine/httpebble-watch/find/master" data-pjax data-hotkey="t" class="js-show-file-finder" style="display:none">Show File Finder</a>

<div class="file-navigation">
  


<div class="select-menu js-menu-container js-select-menu" >
  <span class="minibutton select-menu-button js-menu-target" data-hotkey="w"
    data-master-branch="master"
    data-ref="master"
    role="button" aria-label="Switch branches or tags" tabindex="0">
    <span class="octicon octicon-git-branch"></span>
    <i>branch:</i>
    <span class="js-select-button">master</span>
  </span>

  <div class="select-menu-modal-holder js-menu-content js-navigation-container" data-pjax>

    <div class="select-menu-modal">
      <div class="select-menu-header">
        <span class="select-menu-title">Switch branches/tags</span>
        <span class="octicon octicon-remove-close js-menu-close"></span>
      </div> <!-- /.select-menu-header -->

      <div class="select-menu-filters">
        <div class="select-menu-text-filter">
          <input type="text" aria-label="Filter branches/tags" id="context-commitish-filter-field" class="js-filterable-field js-navigation-enable" placeholder="Filter branches/tags">
        </div>
        <div class="select-menu-tabs">
          <ul>
            <li class="select-menu-tab">
              <a href="#" data-tab-filter="branches" class="js-select-menu-tab">Branches</a>
            </li>
            <li class="select-menu-tab">
              <a href="#" data-tab-filter="tags" class="js-select-menu-tab">Tags</a>
            </li>
          </ul>
        </div><!-- /.select-menu-tabs -->
      </div><!-- /.select-menu-filters -->

      <div class="select-menu-list select-menu-tab-bucket js-select-menu-tab-bucket" data-tab-filter="branches">

        <div data-filterable-for="context-commitish-filter-field" data-filterable-type="substring">


            <div class="select-menu-item js-navigation-item selected">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <a href="/Katharine/httpebble-watch/blob/master/README.md"
                 data-name="master"
                 data-skip-pjax="true"
                 rel="nofollow"
                 class="js-navigation-open select-menu-item-text js-select-button-text css-truncate-target"
                 title="master">master</a>
            </div> <!-- /.select-menu-item -->
        </div>

          <div class="select-menu-no-results">Nothing to show</div>
      </div> <!-- /.select-menu-list -->

      <div class="select-menu-list select-menu-tab-bucket js-select-menu-tab-bucket" data-tab-filter="tags">
        <div data-filterable-for="context-commitish-filter-field" data-filterable-type="substring">


        </div>

        <div class="select-menu-no-results">Nothing to show</div>
      </div> <!-- /.select-menu-list -->

    </div> <!-- /.select-menu-modal -->
  </div> <!-- /.select-menu-modal-holder -->
</div> <!-- /.select-menu -->

  <div class="breadcrumb">
    <span class='repo-root js-repo-root'><span itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb"><a href="/Katharine/httpebble-watch" data-branch="master" data-direction="back" data-pjax="true" itemscope="url"><span itemprop="title">httpebble-watch</span></a></span></span><span class="separator"> / </span><strong class="final-path">README.md</strong> <span class="js-zeroclipboard minibutton zeroclipboard-button" data-clipboard-text="README.md" data-copied-hint="copied!" title="copy to clipboard"><span class="octicon octicon-clippy"></span></span>
  </div>
</div>



  <div class="commit file-history-tease">
      <img class="main-avatar" height="24" src="https://0.gravatar.com/avatar/7c092510e1e158c1749dbc473eb9e961?d=https%3A%2F%2Fidenticons.github.com%2F87e827849f1588f4b8bacbfc4c87eeca.png&amp;s=140" width="24" />
      <span class="author"><a href="/Katharine" rel="author">Katharine</a></span>
      <time class="js-relative-date" datetime="2013-09-27T14:34:24-07:00" title="2013-09-27 14:34:24">September 27, 2013</time>
      <div class="commit-title">
          <a href="/Katharine/httpebble-watch/commit/b98e06451f1774c785a7a750b4da27b319c1c7a3" class="message" data-pjax="true" title="Mention binary response type">Mention binary response type</a>
      </div>

      <div class="participation">
        <p class="quickstat"><a href="#blob_contributors_box" rel="facebox"><strong>1</strong> contributor</a></p>
        
      </div>
      <div id="blob_contributors_box" style="display:none">
        <h2 class="facebox-header">Users who have contributed to this file</h2>
        <ul class="facebox-user-list">
          <li class="facebox-user-list-item">
            <img height="24" src="https://0.gravatar.com/avatar/7c092510e1e158c1749dbc473eb9e961?d=https%3A%2F%2Fidenticons.github.com%2F87e827849f1588f4b8bacbfc4c87eeca.png&amp;s=140" width="24" />
            <a href="/Katharine">Katharine</a>
          </li>
        </ul>
      </div>
  </div>

<div id="files" class="bubble">
  <div class="file">
    <div class="meta">
      <div class="info">
        <span class="icon"><b class="octicon octicon-file-text"></b></span>
        <span class="mode" title="File Mode">file</span>
          <span>663 lines (423 sloc)</span>
        <span>29.263 kb</span>
      </div>
      <div class="actions">
        <div class="button-group">
              <a class="minibutton disabled js-entice" href=""
                 data-entice="You must be signed in to make or propose changes">Edit</a>
          <a href="/Katharine/httpebble-watch/raw/master/README.md" class="button minibutton " id="raw-url">Raw</a>
            <a href="/Katharine/httpebble-watch/blame/master/README.md" class="button minibutton ">Blame</a>
          <a href="/Katharine/httpebble-watch/commits/master/README.md" class="button minibutton " rel="nofollow">History</a>
        </div><!-- /.button-group -->
            <a class="minibutton danger empty-icon js-entice" href=""
               data-entice="You must be signed in and on a branch to make or propose changes">
            Delete
          </a>
      </div><!-- /.actions -->

    </div>
      
  <div id="readme" class="blob instapaper_body">
    <article class="markdown-body entry-content" itemprop="mainContentOfPage"><h1>
<a name="httpebble" class="anchor" href="#httpebble"><span class="octicon octicon-link"></span></a>httpebble</h1>

<p>httpebble is a scheme for communicating with the internet from the Pebble, using a generic protocol
and without any application-specific code running on the phone. It also provides a mechanism for
storing persistent data, reading timezone information, and getting the user's approximate location.</p>

<p>Due to restrictions of the two-way communication SDK, only one application can communicate with the
watch simultaneously. That means that using this HTTP support will break RunKeeper or any other app
with a custom app. There is no workaround for this at this time. However, by using the same UUID for
all apps that want to use HTTP requests, any number of watch apps can use this functionality simultaneously.</p>

<p>Therefore, your app must have the UUID <code>9141B628-BC89-498E-B147-049F49C099AD</code> for this to function.
In list form, that is <code>{ 0x91, 0x41, 0xB6, 0x28, 0xBC, 0x89, 0x49, 0x8E, 0xB1, 0x47, 0x04, 0x9F, 0x49, 0xC0, 0x99, 0xAD }</code>,
and it is defined as <code>HTTP_UUID</code> in the httpebble headers.
If this causes duplicates
you may have issues using libpebble.</p>

<h2>
<a name="samples-and-code" class="anchor" href="#samples-and-code"><span class="octicon octicon-link"></span></a>Samples and Code</h2>

<p>The Pebble-side prototype can be found <a href="https://github.com/Katharine/httpebble-watch">here</a>. Just
drop the files in, <code>#include "http.h"</code> and call the functions as documented.</p>

<p>The source for the iPhone bridge app (which has no UI whatsoever) can be found <a href="https://github.com/Katharine/httpebble-ios">here</a>.</p>

<p>A <a href="http://builds.cloudpebble.net/2/7/2702284fdcbf4212a1c0baa1cd8c182e/watchface.pbw">sample watch face</a> has
been built using httpebble, demonstrating HTTP requests and location determination.
It replicates one of the watch faces found on getpebble.com, but never made available:</p>

<p><a href="https://github-camo.global.ssl.fastly.net/8c5954b6fda4390eab0cda7a2b8c2191d2abc85d/687474703a2f2f692e696d6775722e636f6d2f534f756a696c732e6a7067" target="_blank"><img src="https://github-camo.global.ssl.fastly.net/8c5954b6fda4390eab0cda7a2b8c2191d2abc85d/687474703a2f2f692e696d6775722e636f6d2f534f756a696c732e6a7067" alt="" style="max-width:100%;"></a></p>

<p>The source can be found <a href="https://github.com/Katharine/WeatherWatch">here</a>. It will automatically determine your location using your
phone's GPS.
The simple PHP file it interacts with can be viewed <a href="/Katharine/httpebble-watch/blob/master/./weather2.phps">here</a>. You will need
a free API key from <a href="http://forecast.io">forecast.io</a> to use it.</p>

<hr><p>A sample app demonstrating the timezone information can be found <a href="http://builds.cloudpebble.net/3/3/3381a161742b4e22a141098f8e0e2ced/watchface.pbw">here</a>.
It simply displays your timezone's name and offset from GMT, whether DST is active, and the current unix timestamp:</p>

<p><a href="https://github-camo.global.ssl.fastly.net/bd11540b8b2bc323090154a788c53da7c0fef2fc/687474703a2f2f692e696d6775722e636f6d2f7a4631353238772e6a7067" target="_blank"><img src="https://github-camo.global.ssl.fastly.net/bd11540b8b2bc323090154a788c53da7c0fef2fc/687474703a2f2f692e696d6775722e636f6d2f7a4631353238772e6a7067" alt="" style="max-width:100%;"></a></p>

<p>Source can be found <a href="https://github.com/Katharine/httpebble-timezone-demo">on GitHub</a>.</p>

<hr><p>A sample app demonstrating persistent data storage can be found <a href="http://builds.cloudpebble.net/5/f/5ff46d27741741dab5cc768fe68780fb/watchface.pbw">here</a>.
You can increment the value by pressing (or holding) up, and decrement is by pressing (or holding) down. You can save the value by clicking select, and
delete it by holding down select. Try leaving and returning to the app.</p>

<p>Source can be found <a href="https://github.com/Katharine/httpebble-counter-demo">on GitHub</a>.</p>

<h2>
<a name="http-server-interface" class="anchor" href="#http-server-interface"><span class="octicon octicon-link"></span></a>HTTP Server Interface</h2>

<p>This section describes how httpebble interacts with remote servers and is of interest to application developers.</p>

<h3>
<a name="pebble-to-server" class="anchor" href="#pebble-to-server"><span class="octicon octicon-link"></span></a>Pebble to server</h3>

<p>All requests made via httpebble are sent as HTTP POST requests with content type <code>application/json</code>.
The key/value pairs attached to the request are sent as a flat JSON dictionary. There cannot be any nesting.
Additionally, the client will send the HTTP header <code>X-Pebble-ID</code>, containing the serial number of the Pebble.</p>

<p>Since JSON requires string keys, all dictionary keys will be the decimal string form of the integers provided.
All integers will be provided as JSON integers, and cstrings as JSON strings. For example, a request might look
like this:</p>

<pre><code>{"1": 42, "2": -71, "3": "uk"}
</code></pre>

<p>Note that floating point values cannot be sent due to limitations of the Pebble AppMessage protocol.</p>

<p>The keys <code>0xF000</code> through <code>0xFFFF</code> are reserved by the protocol; using them is undefined.</p>

<h3>
<a name="server-to-pebble" class="anchor" href="#server-to-pebble"><span class="octicon octicon-link"></span></a>Server to Pebble</h3>

<p>The server should respond with a flat JSON dictionary. All keys must be the decimal string representation of
signed 32-bit integers.</p>

<p>The keys <code>0xF000</code> through <code>0xFFFF</code> are reserved by the protocol; using them is undefined.</p>

<p>Values in the dictionary may be specified as follows:</p>

<ul>
<li>strings will be passed to the Pebble as cstrings (and thus should not contain null bytes).</li>
<li>integers can either be specified in two ways:

<ul>
<li>Specifying an integer directly will encode it as a 32-bit signed integer when passing it to the Pebble</li>
<li>Integer size can be specified by instead giving the value as a <code>[width, value]</code> tuple. Specifying a value wider than the given width is undefined.
<code>value</code> should be passed as a JSON integer.
Valid values for <code>width</code> are:

<ul>
<li>
<code>'b'</code> – signed eight-bit integer</li>
<li>
<code>'B'</code> – unsigned eight-bit integer</li>
<li>
<code>'s'</code> – signed 16-bit integer</li>
<li>
<code>'S'</code> – unsigned 16-bit integer</li>
<li>
<code>'i'</code> – signed 32-bit integer</li>
<li>
<code>'I'</code> – unsigned 32-bit integer</li>
</ul>
</li>
</ul>
</li>
<li>Binary data may be specified as a tuple like so:

<ul>
<li>[<code>d</code>, base64-encoded-data]</li>
</ul>
</li>
</ul><p>Here is a sample valid response message:</p>

<pre><code>{"1": ['b', 7], "2": ['s', 18], "3": "Some string", "4": 17}
</code></pre>

<h2>
<a name="pebble-api-general" class="anchor" href="#pebble-api-general"><span class="octicon octicon-link"></span></a>Pebble API: General</h2>

<p>This section describes methods relevant to all parts of httpebble.</p>

<h3>
<a name="methods" class="anchor" href="#methods"><span class="octicon octicon-link"></span></a>Methods</h3>

<h4>
<a name="http_set_app_idint32_t-app_id" class="anchor" href="#http_set_app_idint32_t-app_id"><span class="octicon octicon-link"></span></a>http_set_app_id(int32_t app_id)</h4>

<p><code>void http_set_app_id(int32_t id);</code></p>

<p>It is <em>strongly</em> recommended that you call this method with some (really) random integer somewhere in the 32-bit
signed integer range. Setting it uniquely ensures that your app will not receive misdirected responses or mix its
dict storage keys with another app.</p>

<h4>
<a name="http_register_callbacks" class="anchor" href="#http_register_callbacks"><span class="octicon octicon-link"></span></a>http_register_callbacks</h4>

<p><code>bool http_register_callbacks(HTTPCallbacks callbacks, void* context);</code></p>

<p>Registers the HTTP callbacks with the AppMessages system, and registers the provided <code>HTTPCallbacks</code>
with the HTTP system. Calling this method repeatedly will overwrite any previous handlers.</p>

<p><code>context</code> will be passed to any callbacks.</p>

<h3>
<a name="structs" class="anchor" href="#structs"><span class="octicon octicon-link"></span></a>Structs</h3>

<h4>
<a name="httpcallbacks" class="anchor" href="#httpcallbacks"><span class="octicon octicon-link"></span></a>HTTPCallbacks</h4>

<pre><code>typedef struct {
    HTTPRequestFailedHandler failure;
    HTTPRequestSucceededHandler success;
    HTTPReconnectedHandler reconnect;
    HTTPPhoneCookieGetHandler cookie_get;
    HTTPPhoneCookieBatchGetHandler cookie_batch_get;
    HTTPPhoneCookieSetHandler cookie_set;
    HTTPPhoneCookieFsyncHandler cookie_fsync;
    HTTPPhoneCookieDeleteHandler cookie_delete;
    HTTPTimeHandler time;
    HTTPLocationHandler location;
} HTTPCallbacks;
</code></pre>

<p>This is passed to <code>http_register_callbacks</code> to register callbacks. All of the callbacks are optional, and you need
only register those pertaining to functionality you actually use.</p>

<h3>
<a name="error-codes" class="anchor" href="#error-codes"><span class="octicon octicon-link"></span></a>Error codes</h3>

<ul>
<li>
<code>HTTP_OK</code> – Everything is fine.</li>
<li>
<code>HTTP_SEND_TIMEOUT</code> – There was a timeout attempting to contact the bridge on the user's phone.</li>
<li>
<code>HTTP_NOT_CONNECTED</code> – The watch is not connected to a phone.</li>
<li>
<code>HTTP_BRIDGE_NOT_RUNNING</code> – The HTTP bridge is not running on the user's phone.</li>
<li>
<code>HTTP_INVALID_ARGS</code> – The function was called with invalid arguments.</li>
<li>
<code>HTTP_BUSY</code> – There are other pending inbound or outbound messages preventing communication.
Notably, this will occur if you try calling <code>http_out_get</code> in the app's <code>init_handler</code>.</li>
<li>
<code>HTTP_BUFFER_OVERFLOW</code> – The buffer was too small to contain the incoming message.</li>
<li>
<code>HTTP_NOT_ENOUGH_STORAGE</code> – The backing store did not have enough space.</li>
<li>
<code>HTTP_INTERNAL_INCONSISTENCY</code> – Something is very broken.</li>
<li>
<code>HTTP_INVALID_BRIDGE_RESPONSE</code> – The bridge on the user's phone returned an invalid response.</li>
</ul><h2>
<a name="pebble-api-http-requests" class="anchor" href="#pebble-api-http-requests"><span class="octicon octicon-link"></span></a>Pebble API: HTTP Requests</h2>

<p>This section describes the prototype user-space Pebble API and is of interest to application developers.</p>

<h3>
<a name="methods-1" class="anchor" href="#methods-1"><span class="octicon octicon-link"></span></a>Methods</h3>

<h4>
<a name="http_out_get" class="anchor" href="#http_out_get"><span class="octicon octicon-link"></span></a>http_out_get</h4>

<p><code>HTTPResult http_out_get(const char* url, int32_t cookie, DictionaryIterator **iter_out);</code></p>

<p>Prepares an HTTP POST request to <code>url</code>. The provided <code>cookie</code> <strong>shall</strong> be provided to success callbacks, and
<strong>may</strong> be provided to failure callbacks.</p>

<p><code>iter_out</code> will point to a <code>DictionaryIterator</code>. Any values set on this dictionary will be included the POST
data to the specified URL.</p>

<p>It is considered impolite to call this function unless you intend to call <code>http_out_send</code> immediately. <strong>This function cannot be called during
your app's init_handler.</strong></p>

<p>May return <code>HTTP_OK</code>, <code>HTTP_BUSY</code>, <code>HTTP_INVALID_ARGS</code>, <code>HTTP_NOT_ENOUGH_STORAGE</code> or <code>HTTP_INTERNAL_INCONSISTENCY</code>.</p>

<h4>
<a name="http_out_send" class="anchor" href="#http_out_send"><span class="octicon octicon-link"></span></a>http_out_send</h4>

<p><code>HTTPResult http_out_send();</code></p>

<p>Sends the HTTP POST request previously prepared by <code>http_out_get</code>; fails if there hasn't been one since the
last call.</p>

<p>May return <code>HTTP_OK</code> or <code>HTTP_BUSY</code>.</p>

<h3>
<a name="callbacks" class="anchor" href="#callbacks"><span class="octicon octicon-link"></span></a>Callbacks</h3>

<h4>
<a name="httprequestsucceededhandler" class="anchor" href="#httprequestsucceededhandler"><span class="octicon octicon-link"></span></a>HTTPRequestSucceededHandler</h4>

<p><code>typedef void(*HTTPRequestSucceededHandler)(int32_t cookie, int http_status, DictionaryIterator* response, void* context);</code></p>

<p>Called when an HTTP request succeeds.</p>

<ul>
<li>
<code>cookie</code> is the cookie provided to <code>http_out_get</code>.</li>
<li>
<code>http_status</code> is the HTTP status code returned by the remote server (usually 200)</li>
<li>
<code>response</code> is a <code>DictionaryIterator</code> pointing at a dictionary containing the server's response to the request.</li>
<li>
<code>context</code> is the value provided in <code>http_register_callbacks</code>.</li>
</ul><p>Implementation limitations mean that it is plausible you will receive a misdirected response, so specifying and checking
the cookie is recommended.</p>

<h4>
<a name="httprequestfailedhandler" class="anchor" href="#httprequestfailedhandler"><span class="octicon octicon-link"></span></a>HTTPRequestFailedHandler</h4>

<p><code>typedef void(*HTTPRequestFailedHandler)(int32_t cookie, int http_status, void* context);</code></p>

<p>Called when an HTTP request fails, on a best-effort basis. Requests may fail without any warning.</p>

<ul>
<li>
<code>cookie</code> will be either the cookie provided to <code>http_out_get</code> (if it could be retrieved) or zero.</li>
<li>
<code>http_status</code> will be the HTTP status code returned by the server if the request was made at all, or 
an <code>HTTPResult</code> code plus 1000. You can check which by comparing against 1000.</li>
<li>
<code>context</code> is the value provided in <code>http_register_callbacks</code>.</li>
</ul><h4>
<a name="httpreconnectedhandler" class="anchor" href="#httpreconnectedhandler"><span class="octicon octicon-link"></span></a>HTTPReconnectedHandler</h4>

<p><code>typedef void(*HTTPReconnectedHandler)(void* context);</code></p>

<p>This is called when the watch connects or reconnects to the phone app.</p>

<ul>
<li>
<code>context</code> is the value provided in <code>http_register_callbacks</code>.</li>
</ul><h2>
<a name="pebble-api-local-cookies" class="anchor" href="#pebble-api-local-cookies"><span class="octicon octicon-link"></span></a>Pebble API: Local Cookies</h2>

<p>The "Local Cookie" system enables your watch apps to store local data in a key-value store. You should
understand that the data storage is best-effort, and may be wiped without warning (e.g. because the user)
deleted the phone app or similar. For critical information, consider using the HTTP API and X-Pebble-ID
header to store the data remotely. All local cookie functions take a leading <code>request_id</code> argument that will
be returned to the application in any callbacks; it can take any integer value.</p>

<h3>
<a name="methods-2" class="anchor" href="#methods-2"><span class="octicon octicon-link"></span></a>Methods</h3>

<h4>
<a name="http_cookie_set_int" class="anchor" href="#http_cookie_set_int"><span class="octicon octicon-link"></span></a>http_cookie_set_int</h4>

<p><code>HTTPResult http_cookie_set_int(uint32_t request_id, uint32_t key, const void* integer, uint8_t width_bytes, bool is_signed);</code></p>

<p>This method sets the given key to an integer of width <code>1</code>, <code>2</code> or <code>4</code> bytes, signed or not as appropriate</p>

<ul>
<li>
<code>request_id</code> is an application-defined request ID</li>
<li>
<code>key</code> is the key to set a value on</li>
<li>
<code>integer</code> is a pointer to the value to set</li>
<li>
<code>width_bytes</code> is the number of bytes in the integer:

<ul>
<li>
<code>1</code> for an <code>int8</code> or <code>uint8</code>
</li>
<li>
<code>2</code> for an <code>int16</code> or <code>uint16</code>
</li>
<li>
<code>4</code> for an <code>int32</code> or <code>uint32</code>
</li>
<li>No other value is acceptable</li>
</ul>
</li>
<li>
<code>is_signed</code> indicates whether the value is signed or not.</li>
</ul><h4>
<a name="http_cookie_set_int-1" class="anchor" href="#http_cookie_set_int-1"><span class="octicon octicon-link"></span></a>http_cookie_set_int…</h4>

<p><code>HTTPResult http_cookie_set_int32(uint32_t request_id, uint32_t key, int32_t value);</code><br><code>HTTPResult http_cookie_set_uint32(uint32_t request_id, uint32_t key, uint32_t value);</code><br><code>HTTPResult http_cookie_set_int16(uint32_t request_id, uint32_t key, int16_t value);</code><br><code>HTTPResult http_cookie_set_uint16(uint32_t request_id, uint32_t key, uint16_t value);</code><br><code>HTTPResult http_cookie_set_int8(uint32_t request_id, uint32_t key, int8_t value);</code><br><code>HTTPResult http_cookie_set_uint8(uint32_t request_id, uint32_t key, uint8_t value);</code>  </p>

<p>These are helper methods for the above <code>http_cookie_set</code>.</p>

<ul>
<li>
<code>request_id</code> is an application-defined request ID</li>
<li>
<code>key</code> is the key to set</li>
<li>
<code>value</code> is the value to set.</li>
</ul><h4>
<a name="http_cookie_set_cstring" class="anchor" href="#http_cookie_set_cstring"><span class="octicon octicon-link"></span></a>http_cookie_set_cstring</h4>

<p><code>HTTPResult http_cookie_set_cstring(uint32_t request_id, uint32_t key, const char* value);</code></p>

<p>Sets the key <code>key</code> to be the C string <code>value</code>.</p>

<h4>
<a name="http_cookie_set_data" class="anchor" href="#http_cookie_set_data"><span class="octicon octicon-link"></span></a>http_cookie_set_data</h4>

<p><code>HTTPResult http_cookie_set_data(uint32_t request_id, uint32_t key, const uint8_t* const value, int length);</code></p>

<p>Sets the key <code>key</code> to hold <code>length</code> bytes of the arbitrary buffer <code>value</code>.</p>

<h4>
<a name="http_cookie_get" class="anchor" href="#http_cookie_get"><span class="octicon octicon-link"></span></a>http_cookie_get</h4>

<p><code>HTTPResult http_cookie_get(uint32_t request_id, uint32_t key);</code></p>

<p>Requests that the given <code>key</code> be retrieved. A callback will be fired when it is available.</p>

<h4>
<a name="http_cookie_delete" class="anchor" href="#http_cookie_delete"><span class="octicon octicon-link"></span></a>http_cookie_Delete</h4>

<p><code>HTTPResult http_cookie_delete(uint32_t request_id, uint32_t key);</code></p>

<p>Deletes <code>key</code> from the data store.</p>

<h4>
<a name="http_cookie_set_start" class="anchor" href="#http_cookie_set_start"><span class="octicon octicon-link"></span></a>http_cookie_set_start</h4>

<p><code>HTTPResult http_cookie_set_start(int32_t request_id, DictionaryIterator **iter_out);</code></p>

<p>Starts a cookie setting session for setting multiple keys simultaneously.
<code>iter_out</code> will point to a dictionary that you can write keys into using the standard dictionary writing methods.</p>

<p><code>http_cookie_set_end</code> should be called as soon as possible after this function to commit the results.</p>

<h4>
<a name="http_cookie_set_end" class="anchor" href="#http_cookie_set_end"><span class="octicon octicon-link"></span></a>http_cookie_set_end</h4>

<p><code>HTTPResult http_cookie_set_end();</code></p>

<p>Ends a cookie setting session and sets any keys on the associated dictionary.</p>

<h4>
<a name="http_cookie_get_multiple" class="anchor" href="#http_cookie_get_multiple"><span class="octicon octicon-link"></span></a>http_cookie_get_multiple</h4>

<p><code>HTTPResult http_cookie_get_multiple(int32_t request_id, uint32_t* keys, int32_t length);</code></p>

<p>Request multiple keys at once.</p>

<ul>
<li>
<code>keys</code> is an array of keys to fetch</li>
<li>
<code>length</code> is the number of keys in <code>keys</code>.</li>
</ul><h4>
<a name="http_cookie_delete_multiple" class="anchor" href="#http_cookie_delete_multiple"><span class="octicon octicon-link"></span></a>http_cookie_delete_multiple</h4>

<p>Delete multiple keys at once.</p>

<ul>
<li>
<code>keys</code> is an array of keys to delete</li>
<li>
<code>length</code> is the number of keys in <code>keys</code>.</li>
</ul><h4>
<a name="http_cookie_fsync" class="anchor" href="#http_cookie_fsync"><span class="octicon octicon-link"></span></a>http_cookie_fsync</h4>

<p><code>HTTPResult http_cookie_fsync();</code></p>

<p>This function can optionally be called to ensure that the values are committed to disk on the phone (or some sort
of error will be raised). It is generally unnecessary to call it, and the current iOS implementation syncs after
each write or delete command anyway.</p>

<h3>
<a name="callbacks-1" class="anchor" href="#callbacks-1"><span class="octicon octicon-link"></span></a>Callbacks</h3>

<p>There are lots of them, some of which are redundant to each other, depending on your needs.</p>

<h4>
<a name="httpphonecookiebatchgethandler" class="anchor" href="#httpphonecookiebatchgethandler"><span class="octicon octicon-link"></span></a>HTTPPhoneCookieBatchGetHandler</h4>

<p><code>typedef void(*HTTPPhoneCookieBatchGetHandler)(int32_t request_id, DictionaryIterator* result, void* context);</code></p>

<p>Called when a request for values (either one or many) completes. Keys not found will be omitted from the result dictionary.</p>

<ul>
<li>
<code>request_id</code> is the id passed in when requesting the value</li>
<li>
<code>result</code> is a dictionary containing all the values set, and possibly some control values – disregard any
value between 0xF000 and 0xFFFF if iterating over the dictionary.</li>
<li>
<code>context</code> is the context value passed to <code>http_register_callbacks</code>
</li>
</ul><h4>
<a name="httpphonecookiegethandler" class="anchor" href="#httpphonecookiegethandler"><span class="octicon octicon-link"></span></a>HTTPPhoneCookieGetHandler</h4>

<p><code>typedef void(*HTTPPhoneCookieGetHandler)(int32_t request_id, Tuple* result, void* context);</code></p>

<p>Called when a request for values (either one or many) completes. Contains only a single value, and called for every
key in the returned set (but no system-reserved keys). Will not be called for keys not found.</p>

<ul>
<li>
<code>request_id</code> is the id passed in when requesting the value.</li>
<li>
<code>result</code> is a Tuple containing a single key/value pair</li>
<li>
<code>context</code> is the context value passed to <code>http_register_callbacks</code>
</li>
</ul><h4>
<a name="httpphonecookiesethandler" class="anchor" href="#httpphonecookiesethandler"><span class="octicon octicon-link"></span></a>HTTPPhoneCookieSetHandler</h4>

<p><code>typedef void(*HTTPPhoneCookieSetHandler)(int32_t request_id, bool successful, void* context);</code></p>

<p>Called to indicate the success or otherwise of a request to set keys. If tracking failure is important to you,
you should also check for errors above 1000 in a <code>HTTPRequestFailedHandler</code> callback.</p>

<ul>
<li>
<code>request_id</code> is the value passed in when setting the values</li>
<li>
<code>successful</code> indicates the success of storing the values</li>
<li>
<code>context</code> is the context value passed to <code>http_register_callbacks</code>
</li>
</ul><h4>
<a name="httpphonecookiedeletehandler" class="anchor" href="#httpphonecookiedeletehandler"><span class="octicon octicon-link"></span></a>HTTPPhoneCookieDeleteHandler</h4>

<p><code>typedef void(*HTTPPhoneCookieDeleteHandler)(int32_t request_id, bool successful, void* context);</code></p>

<p>Called to indicate the success or otherwise of a request to delete keys. If tracking failure is important to you,
you should also check for errors above 1000 in a <code>HTTPRequestFailedHandler</code> callback.</p>

<ul>
<li>
<code>request_id</code> is the value passed in when setting the values</li>
<li>
<code>successful</code> indicates the success of storing the values</li>
<li>
<code>context</code> is the context value passed to <code>http_register_callbacks</code>
</li>
</ul><h4>
<a name="httpphonecookiefsynchandler" class="anchor" href="#httpphonecookiefsynchandler"><span class="octicon octicon-link"></span></a>HTTPPhoneCookieFsyncHandler</h4>

<p><code>typedef void(*HTTPPhoneCookieFsyncHandler)(int32_t request_id, bool successful, void* context);</code></p>

<p>Called to indicate the success or otherwise of an fsync request. If tracking failure is important to you,
you should also check for errors above 1000 in a <code>HTTPRequestFailedHandler</code> callback.</p>

<ul>
<li>
<code>request_id</code> is the value passed in when setting the values</li>
<li>
<code>successful</code> indicates the success of storing the values</li>
<li>
<code>context</code> is the context value passed to <code>http_register_callbacks</code>
</li>
</ul><h2>
<a name="pebble-api-timezones" class="anchor" href="#pebble-api-timezones"><span class="octicon octicon-link"></span></a>Pebble API: Timezones</h2>

<p>The timezone functionality enables your watch app to determine the user's timezone. The accuracy of these functions
depends on the accuracy of the user's phone's clock.</p>

<h3>
<a name="functions" class="anchor" href="#functions"><span class="octicon octicon-link"></span></a>Functions</h3>

<h4>
<a name="http_time_request" class="anchor" href="#http_time_request"><span class="octicon octicon-link"></span></a>http_time_request</h4>

<p><code>HTTPResult http_time_request();</code></p>

<p>Requests the user's timezone information from the phone.</p>

<h3>
<a name="callbacks-2" class="anchor" href="#callbacks-2"><span class="octicon octicon-link"></span></a>Callbacks</h3>

<h4>
<a name="http_time_handler" class="anchor" href="#http_time_handler"><span class="octicon octicon-link"></span></a>http_time_handler</h4>

<p><code>typedef void(*HTTPTimeHandler)(int32_t utc_offset_seconds, bool is_dst, uint32_t unixtime, const char* tz_name);</code></p>

<p>Called when timezone information is available.</p>

<ul>
<li>
<code>utc_offset_seconds</code> is the user's offset from UTC in seconds (may not be a multiple of 3600; may be negative)</li>
<li>
<code>is_dst</code> indicates whether it is currently Daylight Saving Time in the user's timezone</li>
<li>
<code>unixtime</code> gives the current unix timestamp (seconds since 1st January 1970, UTX)</li>
<li>
<code>tz_name</code> gives the name of the user's timezone (e.g. <code>"America/New_York"</code>). This value is allocated on the
stack and must be copied for use outside the callback. This value may not be available, or may only give UTC
offset, depending on the user's time settings.</li>
</ul><p>Note that the <code>unixtime</code> is accurate as of the phone receiving and processing the message; not as of the time this
callback occurs. That said, there is usually no discernable latency between the two events.</p>

<h2>
<a name="pebble-api-location" class="anchor" href="#pebble-api-location"><span class="octicon octicon-link"></span></a>Pebble API: Location</h2>

<p>The location API enables your application to determine a once-off reasonably accurate location for the user. The
resulting values should be accurate to within about a kilometre.</p>

<h3>
<a name="functions-1" class="anchor" href="#functions-1"><span class="octicon octicon-link"></span></a>Functions</h3>

<h4>
<a name="http_location_request" class="anchor" href="#http_location_request"><span class="octicon octicon-link"></span></a>http_location_request</h4>

<p><code>HTTPResult http_location_request();</code></p>

<p>Requests the user's approximate location from the phone, as determined via GPS or other means at the phone's
discretion.</p>

<h3>
<a name="callbacks-3" class="anchor" href="#callbacks-3"><span class="octicon octicon-link"></span></a>Callbacks</h3>

<h4>
<a name="httplocationhandler" class="anchor" href="#httplocationhandler"><span class="octicon octicon-link"></span></a>HTTPLocationHandler</h4>

<p><code>typedef void(*HTTPLocationHandler)(float latitude, float longitude, float altitude, float accuracy, void* context);</code></p>

<p>Called when the user's location is available.</p>

<ul>
<li>
<code>latitude</code> contains the user's latitude.</li>
<li>
<code>longitude</code> contains the user's longitude.</li>
<li>
<code>altitude</code> contains the user's altitude in metres.</li>
<li>
<code>accuracy</code> contains the uncertainty of the <em>two-dimensional</em> location given in metres.</li>
</ul><p>In general, <code>altitude</code> will probably be less accurate than <code>latitude</code> and <code>longitude</code>.</p>

<h2>
<a name="bridge-interface" class="anchor" href="#bridge-interface"><span class="octicon octicon-link"></span></a>Bridge Interface</h2>

<p>This section describes the pebble/bridge communication protocol, and is probably not of interest to application developers. It is,
however, of interest to anyone who has reason to implement their own bridge.</p>

<p><strong>NB:</strong> If implementing your own bridge, please use the UUID <code>9141B628-BC89-498E-B147-049F49C099AD</code> if your bridge is compliant with
this specification. This allows all applications to use your bridge, rather than breaking them or failing to provide a useful implementation.</p>

<p>Since there is no way for the watch app to initialiate a session, a session should be opened on bridge launch and not closed until bridge exit.</p>

<h3>
<a name="reserved-dictionary-keys" class="anchor" href="#reserved-dictionary-keys"><span class="octicon octicon-link"></span></a>Reserved dictionary keys</h3>

<p>All keys between <code>0xF000</code> and <code>0xFFFF</code> are reserved for use from user applications. Additionally, all keys between <code>0xFF00</code> and <code>0xFFFF</code> are
reserved specifically to <code>httpebble</code>.</p>

<p>The following named dictionary keys are used by the protocol:</p>

<ul>
<li>
<code>0xFFFF</code> – <code>HTTP_URL_KEY</code>: a URL to request</li>
<li>
<code>0xFFFE</code> – <code>HTTP_STATUS_KEY</code>: HTTP status code</li>
<li>
<code>0xFFFC</code> – <code>HTTP_COOKIE_KEY</code>: user-defined cookie</li>
<li><p><code>0xFFFB</code> – <code>HTTP_CONNECT_KEY</code>: sent when a the app connects to the watch</p></li>
<li><p><code>HTTP_URL_KEY</code> (<code>0xFFFF</code>): a URL to request</p></li>
<li><p><code>HTTP_STATUS_KEY</code> (<code>0xFFFE</code>): the HTTP status code</p></li>
<li><p><code>HTTP_REQUEST_ID_KEY</code> (<code>0xFFFC</code>): the request ID specified by the user to return (HTTP requests only)</p></li>
<li><p><code>HTTP_CONNECT_KEY</code> (<code>0xFFFB</code>): indicates that the watch has (re)connected to the phone app</p></li>
<li><p><code>HTTP_APP_ID_KEY</code> (<code>0xFFF2</code>): specifies the application's app ID</p></li>
<li><p><code>HTTP_COOKIE_STORE_KEY</code> (<code>0xFFF0</code>): Request storing key-value data</p></li>
<li><p><code>HTTP_COOKIE_LOAD_KEY</code> (<code>0xFFF1</code>): Request loading key-value data</p></li>
<li><p><code>HTTP_COOKIE_FSYNC_KEY</code> (<code>0xFFF3</code>): Request syncing key-value data</p></li>
<li><p><code>HTTP_COOKIE_DELETE_KEY</code> (<code>0xFFF4</code>): Request deleting key-value data</p></li>
<li><p><code>HTTP_TIME_KEY</code> (<code>0xFFF5</code>): Request timezone information</p></li>
<li><p><code>HTTP_UTC_OFFSET_KEY</code> (<code>0xFFF6</code>): User's UTC offset</p></li>
<li><p><code>HTTP_IS_DST_KEY</code> (<code>0xFFF7</code>): Whether DST is in effect</p></li>
<li><p><code>HTTP_TZ_NAME_KEY</code> (<code>0xFFF8</code>): User's timezone name</p></li>
<li><p><code>HTTP_LOCATION_KEY</code> (<code>0xFFE0</code>): Request location information</p></li>
<li><p><code>HTTP_LATITUDE_KEY</code> (<code>0xFFE1</code>): User's latitude</p></li>
<li><p><code>HTTP_LONGITUDE_KEY</code> (<code>0xFFE2</code>): User's longitude</p></li>
<li><p><code>HTTP_ALTITUDE_KEY</code> (<code>0xFFE3</code>): User's altitude</p></li>
</ul><p>Henceforth they will be referred to by name.</p>

<h3>
<a name="http-requests" class="anchor" href="#http-requests"><span class="octicon octicon-link"></span></a>HTTP requests</h3>

<h4>
<a name="pebble-to-phone" class="anchor" href="#pebble-to-phone"><span class="octicon octicon-link"></span></a>Pebble to Phone</h4>

<p>To make a request the Pebble uses AppMessages to send a dictionary to the bridge app.</p>

<p>The dictionary must contain the following keys at minimum:</p>

<pre><code>HTTP_URL_KEY: (char*)"http://example.com/foo" // Any URL of the user's choosing. Both HTTP and HTTPS should be supported.
HTTP_COOKIE_KEY: (int32_t)42                  // An arbitrary 32-bit signed integer provided by the user, to be sent with the response.
HTTP_APP_ID_KEY: (int32_t)84                  // An arbitrary 32-bit signed integer that uniquely identifies an individual application
</code></pre>

<p>Any additional keys included must be included in the JSON dictionary to be sent to the server, as specified in the Server Interface section.
The cookie should be stored to be returned in the associated response. It <strong>must not</strong> be returned with any other response. The same applies to
the app ID.</p>

<h4>
<a name="phone-to-pebble" class="anchor" href="#phone-to-pebble"><span class="octicon octicon-link"></span></a>Phone to Pebble</h4>

<p>Upon receiving a response (or failing to receive a response), the bridge must communicate this back to the pebble. This
is again achieved by sending an AppMessage. The following keys are used:</p>

<pre><code>HTTP_STATUS_KEY: (uint16_t)200  // An signed 16-bit integer containing the returned HTTP status code.
HTTP_URL_KEY: (uint8_t)1        // An unsigned 8-bit boolean (true/false) indicating whether the request was successful.
HTTP_COOKIE_KEY: (int32_t)42    // An arbitrary 32-bit signed integer provided by the user in the request
HTTP_APP_ID_KEY: (int32_t)84    // An arbitrary 32-bit signed integer that uniquely identifies an individual application.
</code></pre>

<p>In addition, any values provided by the server should be appended to the dictionary, as specified in the Server Interface section.</p>

<p>The current bridge implementation also gives <code>HTTP_STATUS_KEY</code> as <code>500</code> and <code>HTTP_STATUS_KEY</code> as <code>0</code> in the event of an invalid "successful"
response from the server.</p>

<h3>
<a name="indicating-connection" class="anchor" href="#indicating-connection"><span class="octicon octicon-link"></span></a>Indicating connection</h3>

<p>When the phone app discovers the watch, it must send a message to it to activate the connection. That message is as follows:</p>

<pre><code>HTTP_CONNECT_KEY: (uint8_t)1
</code></pre>

<p>This triggers a callback on the watch and also ensures the connection is active. This message is phone to pebble only.</p>

<h3>
<a name="timezone-information" class="anchor" href="#timezone-information"><span class="octicon octicon-link"></span></a>Timezone information</h3>

<h4>
<a name="pebble-to-phone-1" class="anchor" href="#pebble-to-phone-1"><span class="octicon octicon-link"></span></a>Pebble to Phone</h4>

<p>To request timezone information, the Pebble sends the following dictionary via AppMessages:</p>

<pre><code>HTTP_TIME_KEY: (uint8_t)1
</code></pre>

<p>In response, the phone should send time information as below:</p>

<h4>
<a name="phone-to-pebble-1" class="anchor" href="#phone-to-pebble-1"><span class="octicon octicon-link"></span></a>Phone to Pebble</h4>

<p>The response is a dictionary containing the user's current offset from GMT, DST state, a unix timestamp, and the timezone name, a follows:</p>

<pre><code>HTTP_TIME_KEY: (uint32_t)136878176          // The current unix time (unsigned)
HTTP_UTC_OFFSET_KEY: (uint32_t)-14400       // User's offset from UTC in seconds
HTTP_IS_DST_KEY: (uint8_t)1                 // Whether DST is active for the user
HTTP_TZ_NAME_KEY: (char*)"America/New_York" // The name of the user's timezone, if possible.
</code></pre>

<p>The timezone name should ideally be in the standard tzinfo format, but this isn't a hard requirement, and a string containing the UTC offset
would also be acceptable.</p>

<h3>
<a name="location-information" class="anchor" href="#location-information"><span class="octicon octicon-link"></span></a>Location information</h3>

<h4>
<a name="pebble-to-phone-2" class="anchor" href="#pebble-to-phone-2"><span class="octicon octicon-link"></span></a>Pebble to Phone</h4>

<p>The Pebble sends the following dictionary via AppMessages to request the user's location:</p>

<pre><code>HTTP_LOCATION_KEY: (uint8_t)1
</code></pre>

<p>In response, the phone sends location information as below:</p>

<h4>
<a name="phone-to-pebble-2" class="anchor" href="#phone-to-pebble-2"><span class="octicon octicon-link"></span></a>Phone to Pebble</h4>

<p>This response calls for sending floats, which AppMessage does not permit. Instead, the float should be converted to its binary form,
then that binary form reinterpreted as a uint32. Then the resultant uint32 should be sent to the pebble, which will perform the inverse
conversion.</p>

<pre><code>HTTP_LOCATION_KEY: (float)accuracy
HTTP_LATITUDE_KEY: (float)latitude
HTTP_LONGITUDE_KEY: (float)longitude
HTTP_ALTITUDE_KEY: (float)altitude
</code></pre>

<p>The location given should be reasonably accurate, but within a kilometre or so is acceptable.</p>

<h3>
<a name="setting-entries-in-the-key-value-store" class="anchor" href="#setting-entries-in-the-key-value-store"><span class="octicon octicon-link"></span></a>Setting entries in the key-value store</h3>

<h4>
<a name="pebble-to-phone-3" class="anchor" href="#pebble-to-phone-3"><span class="octicon octicon-link"></span></a>Pebble to Phone</h4>

<p>The pebble sends a dictionary containing at least the following keys:</p>

<pre><code>HTTP_COOKIE_STORE_KEY:(int32_t)requestId  // An arbitrary 32-bit signed integer provided by the user in the request
HTTP_APP_ID_KEY: (int32_t)app_id          // An arbitrary 32-bit signed integer that uniquely identifies an individual application
</code></pre>

<p>In addition, the dictionary may include an arbitrary number of additional key/value pairs. Each such pair should be inserted into persistent
storage, maintaining the original type of the value (including the integer width and signedness, if appropriate).</p>

<h4>
<a name="phone-to-pebble-3" class="anchor" href="#phone-to-pebble-3"><span class="octicon octicon-link"></span></a>Phone to Pebble</h4>

<p>The phone responds with the following dictionary to indicate success:</p>

<pre><code>HTTP_COOKIE_STORE_KEY:(int32_t)requestId  // An arbitrary 32-bit signed integer provided by the user in the request
HTTP_APP_ID_KEY: (int32_t)app_Id          // An arbitrary 32-bit signed integer that uniquely identifies an individual application
</code></pre>

<p>This is the same as the received dictionary, but without any user-defined keys.</p>

<h3>
<a name="retrieving-entries-from-the-key-value-store" class="anchor" href="#retrieving-entries-from-the-key-value-store"><span class="octicon octicon-link"></span></a>Retrieving entries from the key-value store</h3>

<h4>
<a name="pebble-to-phone-4" class="anchor" href="#pebble-to-phone-4"><span class="octicon octicon-link"></span></a>Pebble to Phone</h4>

<p>The pebble sends a dictionary containing at least the following keys:</p>

<pre><code>HTTP_COOKIE_LOAD_KEY:(int32_t)requestId  // An arbitrary 32-bit signed integer provided by the user in the request
HTTP_APP_ID_KEY: (int32_t)app_Id          // An arbitrary 32-bit signed integer that uniquely identifies an individual application
</code></pre>

<p>In addition, the dictionary may include an arbitrary number of keys with the uint8 value <code>1</code>. The values of these keys should be ignored;
the keys are those that the user is requesting be retrieved.</p>

<h4>
<a name="phone-to-pebble-4" class="anchor" href="#phone-to-pebble-4"><span class="octicon octicon-link"></span></a>Phone to Pebble</h4>

<p>The phone should respond with a dictionary containing at least the following:</p>

<pre><code>HTTP_COOKIE_LOAD_KEY:(int32_t)requestId  // An arbitrary 32-bit signed integer provided by the user in the request
HTTP_APP_ID_KEY: (int32_t)app_Id          // An arbitrary 32-bit signed integer that uniquely identifies an individual application
</code></pre>

<p>Additionally, for each key requested by the user that was found in the store, that key and its associated value (with original type)
should be inserted into the dictionary. If a requested key could not be found in the dictionary, it should be silently dropped.</p>

<h3>
<a name="deleting-entries-from-the-key-value-store" class="anchor" href="#deleting-entries-from-the-key-value-store"><span class="octicon octicon-link"></span></a>Deleting entries from the key-value store</h3>

<h4>
<a name="pebble-to-phone-5" class="anchor" href="#pebble-to-phone-5"><span class="octicon octicon-link"></span></a>Pebble to Phone</h4>

<p>The pebble sends a dictionary containing at least the following keys:</p>

<pre><code>HTTP_COOKIE_DELETE_KEY:(int32_t)requestId  // An arbitrary 32-bit signed integer provided by the user in the request
HTTP_APP_ID_KEY: (int32_t)app_Id           // An arbitrary 32-bit signed integer that uniquely identifies an individual application
</code></pre>

<p>In addition, the dictionary may include an arbitrary number of keys with the uint8 value <code>1</code>. The values of these keys should be ignored;
the keys are those that the user is requesting be deleted.</p>

<h4>
<a name="phone-to-pebble-5" class="anchor" href="#phone-to-pebble-5"><span class="octicon octicon-link"></span></a>Phone to Pebble</h4>

<p>The phone responds with the following dictionary to indicate success:</p>

<pre><code>HTTP_COOKIE_DELETE_KEY:(int32_t)requestId  // An arbitrary 32-bit signed integer provided by the user in the request
HTTP_APP_ID_KEY: (int32_t)app_Id           // An arbitrary 32-bit signed integer that uniquely identifies an individual application
</code></pre>

<p>This is the same as the received dictionary, but without any user-defined keys.</p>

<h3>
<a name="fsync" class="anchor" href="#fsync"><span class="octicon octicon-link"></span></a>Fsync</h3>

<p>This call is a request to ensure that the persistent data store is actually written out to disk. It should not be necessary.</p>

<h4>
<a name="pebble-to-phone-6" class="anchor" href="#pebble-to-phone-6"><span class="octicon octicon-link"></span></a>Pebble to Phone</h4>

<pre><code>HTTP_COOKIE_LOAD_KEY:(uint8_t)1           // true.
HTTP_APP_ID_KEY: (int32_t)app_Id          // An arbitrary 32-bit signed integer that uniquely identifies an individual application
</code></pre>

<h4>
<a name="phone-to-pebbble" class="anchor" href="#phone-to-pebbble"><span class="octicon octicon-link"></span></a>Phone to Pebbble</h4>

<pre><code>HTTP_COOKIE_LOAD_KEY:(uint8_t)success     // true.
HTTP_APP_ID_KEY: (int32_t)app_Id          // An arbitrary 32-bit signed integer that uniquely identifies an individual application
</code></pre>

<p>Success should be true if the sync was successful, false otherwise. This whole is probably optional, but if not implemented should always
claim to have succeeded.</p></article>
  </div>

  </div>
</div>

<a href="#jump-to-line" rel="facebox[.linejump]" data-hotkey="l" class="js-jump-to-line" style="display:none">Jump to Line</a>
<div id="jump-to-line" style="display:none">
  <form accept-charset="UTF-8" class="js-jump-to-line-form">
    <input class="linejump-input js-jump-to-line-field" type="text" placeholder="Jump to line&hellip;" autofocus>
    <button type="submit" class="button">Go</button>
  </form>
</div>

        </div>

      </div><!-- /.repo-container -->
      <div class="modal-backdrop"></div>
    </div><!-- /.container -->
  </div><!-- /.site -->


    </div><!-- /.wrapper -->

      <div class="container">
  <div class="site-footer">
    <ul class="site-footer-links right">
      <li><a href="https://status.github.com/">Status</a></li>
      <li><a href="http://developer.github.com">API</a></li>
      <li><a href="http://training.github.com">Training</a></li>
      <li><a href="http://shop.github.com">Shop</a></li>
      <li><a href="/blog">Blog</a></li>
      <li><a href="/about">About</a></li>

    </ul>

    <a href="/">
      <span class="mega-octicon octicon-mark-github"></span>
    </a>

    <ul class="site-footer-links">
      <li>&copy; 2013 <span title="0.06075s from github-fe114-cp1-prd.iad.github.net">GitHub</span>, Inc.</li>
        <li><a href="/site/terms">Terms</a></li>
        <li><a href="/site/privacy">Privacy</a></li>
        <li><a href="/security">Security</a></li>
        <li><a href="/contact">Contact</a></li>
    </ul>
  </div><!-- /.site-footer -->
</div><!-- /.container -->


    <div class="fullscreen-overlay js-fullscreen-overlay" id="fullscreen_overlay">
  <div class="fullscreen-container js-fullscreen-container">
    <div class="textarea-wrap">
      <textarea name="fullscreen-contents" id="fullscreen-contents" class="js-fullscreen-contents" placeholder="" data-suggester="fullscreen_suggester"></textarea>
          <div class="suggester-container">
              <div class="suggester fullscreen-suggester js-navigation-container" id="fullscreen_suggester"
                 data-url="/Katharine/httpebble-watch/suggestions/commit">
              </div>
          </div>
    </div>
  </div>
  <div class="fullscreen-sidebar">
    <a href="#" class="exit-fullscreen js-exit-fullscreen tooltipped leftwards" title="Exit Zen Mode">
      <span class="mega-octicon octicon-screen-normal"></span>
    </a>
    <a href="#" class="theme-switcher js-theme-switcher tooltipped leftwards"
      title="Switch themes">
      <span class="octicon octicon-color-mode"></span>
    </a>
  </div>
</div>



    <div id="ajax-error-message" class="flash flash-error">
      <span class="octicon octicon-alert"></span>
      <a href="#" class="octicon octicon-remove-close close ajax-error-dismiss"></a>
      Something went wrong with that request. Please try again.
    </div>

  </body>
</html>

